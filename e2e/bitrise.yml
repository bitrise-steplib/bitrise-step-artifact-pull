format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
  # Shared envs for every test workflow
  - TEST_APP_URL: TODO
  - TEST_APP_BRANCH: TODO

workflows:

  test_pull_single_artifact_success:
    before_run:
    - _setup
    after_run:
    - _check_downloaded_artifacts
    steps:
    - path::./:
        title: Execute step
        inputs:

  # test_pull_artifact_of_different_pipeline_fails:
  #   before_run:
  #   - _setup
  #   after_run:
  #   steps:
  #   - path::./:
  #     title: Execute step
  #     is_skippable: true
  #     inputs:

  _setup:
    steps:
    - script:
        title: Get access token
        inputs:
        - content: |-
            #!/bin/env bash
            set -ex
            bash ./get_access_token.sh
    - script:
        title: Clean _tmp folder
        inputs:
        - content: |-
            #!/bin/env bash
            set -ex
            rm -rf ./_tmp
    - change-workdir:
        title: Switch working dir to _tmp
        run_if: "true"
        inputs:
        - path: ./_tmp
        - is_create_path: true
            
  _check_downloaded_artifacts:
    steps:
    - script:
        title: Validate downloaded artifacts
        is_always_run: true
        inputs:
        - content: |-
            #!/usr/bin/env bash             
            set -ex
            if [ ! -f ./Artifact.zip ]; then
              echo "Artifact.zip not found"
              exit 1
            fi

